<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.renren.modules.job.dao.UserDepartmentDao">
	<select id="queryAllUserDept" resultType="io.renren.modules.job.entity.UserDepartmentEntity" >
		select * from zq_user_department
	</select>
	<select id="queryByTime" parameterType="java.util.HashMap" resultType="java.util.HashMap">
     		select * from zq_user_department 
                <where>
                    <if test="dStart!=null">
                        <![CDATA[  and DATE_FORMAT(#{dEnd}, '%Y-%m-%d %H:%T:%s') >=  
                        DATE_FORMAT(#{dStart}, '%Y-%m-%d %H:%T:%s')   ]]>
                    </if>
                    <if test="dEnd!=null">
                        <![CDATA[  and DATE_FORMAT(created_timestamp, '%Y-%m-%d %H:%T:%s') <= 
                        DATE_FORMAT(#{dEnd} , '%Y-%m-%d %H:%T:%s')    ]]>
                    </if>
                </where>    
                order by created_timestamp desc
    </select>
    
    <delete id="deleteAll">
		delete from zq_user_department
	</delete>
	
	<select id="queryTotal" resultType="int">
		select count(*) from zq_user_department
			   <where>
             		<if test="status !=null ">
						status = #{status}
               		</if>
        		</where> 
    </select>
     <update id="updateStatus"> 
		update zq_user_department set status = case when status = 1 then 0 when status = 0 then 1 end
	</update>
	<delete id="deleteStatus">
		delete from zq_user_department where status = 0 
	</delete>
	<insert id="save" parameterType="io.renren.modules.job.entity.UserDepartmentEntity" >
		insert into zq_user_department
			(
			object_id,
			dep_id,
			user_id,
			created_timestamp
			)
		values 
			(
			 #{objectId,jdbcType=NUMERIC},
			 #{depId,jdbcType=VARCHAR},
			 #{userId,jdbcType=VARCHAR},
			 #{createdTimestamp,jdbcType=TIMESTAMP}
			 )
	</insert>
	
	<insert id="saveBatch" parameterType="java.util.List">
		insert into zq_user_department
			(
			object_id,
			dep_id,
			user_id,
			created_timestamp
			)
		 
		<foreach item="item" collection="list" index="index" separator="union all" >
			(
			 select
			 #{item.objectId,jdbcType=NUMERIC},
			 #{item.depId,jdbcType=VARCHAR},
			 #{item.userId,jdbcType=VARCHAR},
			 #{item.createdTimestamp,jdbcType=TIMESTAMP}
			 from dual
			 )
		</foreach>
	</insert>
</mapper>